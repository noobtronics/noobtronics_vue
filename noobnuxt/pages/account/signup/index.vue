<template>
  <div class="container fullwdithcontainer">
    <div class="content has-text-centered" style="padding: 50px 10px;">
      <div v-if="user_loggedin">
        <h1 class="title is-3">You are logged in already</h1>
      </div>

      <div v-else>
        <div v-if="state == 0">
          <h1 class="title is-3">Sign Up</h1>

          <div class="container has-text-centered">
            <div class="columns is-centered">
              <div class="column is-5 is-4-desktop">
                <form>
                  <div class="field">
                    <div class="control has-icons-left">
                      <input
                        v-model="name"
                        class="input"
                        type="string"
                        placeholder="Name"
                      />
                      <span class="icon is-small is-left">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          x="0px"
                          y="0px"
                          width="24"
                          height="24"
                          viewBox="0 0 172 172"
                          style="fill: #000000;"
                        >
                          <g
                            fill="none"
                            fill-rule="nonzero"
                            stroke="none"
                            stroke-width="1"
                            stroke-linecap="butt"
                            stroke-linejoin="miter"
                            stroke-miterlimit="10"
                            stroke-dasharray=""
                            stroke-dashoffset="0"
                            font-family="none"
                            font-weight="none"
                            font-size="none"
                            text-anchor="none"
                            style="mix-blend-mode: normal;"
                          >
                            <path d="M0,172v-172h172v172z" fill="none"></path>
                            <g fill="#bbbbbb">
                              <path
                                d="M30.96,13.76c-9.44436,0 -17.2,7.75564 -17.2,17.2v110.08c0,9.44437 7.75564,17.2 17.2,17.2h110.08c9.44437,0 17.2,-7.75563 17.2,-17.2v-110.08c0,-9.44436 -7.75563,-17.2 -17.2,-17.2zM30.96,20.64h110.08c5.69163,0 10.32,4.62836 10.32,10.32v110.08c0,4.65877 -3.12366,8.55737 -7.37047,9.83625c-1.0289,-5.50251 -3.50633,-9.91691 -6.78594,-13.24938c-3.99193,-4.05627 -8.96821,-6.62817 -13.81375,-8.72094c-4.84554,-2.09276 -9.62021,-3.72689 -13.2561,-5.53625c-3.52282,-1.7531 -5.5978,-3.56139 -6.49703,-5.64375c-0.21214,-3.5293 -0.24532,-6.43699 -0.24859,-9.57422c1.38069,-1.38506 2.42766,-2.99646 3.44672,-5.08609c1.20935,-2.47983 2.02438,-5.50151 2.53969,-8.53953c2.68577,-1.51976 4.87846,-4.35194 5.40187,-9.55406l0.00672,-0.01344v-0.02016c0.28002,-3.06159 -0.66563,-5.19047 -1.87453,-6.85984c1.46256,-4.65378 3.18978,-11.90925 2.57328,-19.50453c-0.34259,-4.22057 -1.42608,-8.49568 -4.03797,-12.04672c-2.33516,-3.17467 -6.12329,-5.36827 -10.78359,-6.35594c-1.35909,-1.84805 -3.16226,-3.31993 -5.35485,-4.18578c-2.79159,-1.1024 -6.04103,-1.58563 -9.61453,-1.58563h-0.04031h-0.04031c-13.66772,0.3279 -22.55828,6.00958 -26.3711,14.62672c-3.60458,8.1465 -2.84738,18.19051 -0.33594,28.56141c-1.34332,1.66744 -2.48515,3.93067 -1.935,7.21594c0.5509,5.24677 2.80751,7.97697 5.38844,9.43312c0.54516,2.97695 1.41058,5.95943 2.68078,8.45219c0.75229,1.47637 1.55928,2.80317 2.3986,3.93047c0.33457,0.44935 0.82718,0.74437 1.17578,1.13547c0.04266,3.48744 0.17926,6.23536 -0.23515,9.71531c-0.84287,2.15726 -2.88928,3.98757 -6.40969,5.78484c-3.6096,1.84281 -8.38401,3.50036 -13.24266,5.61016c-4.85864,2.10979 -9.85869,4.69013 -13.87422,8.74781c-3.30029,3.33494 -5.80355,7.75221 -6.83969,13.26281c-4.2468,-1.27888 -7.37047,-5.17748 -7.37047,-9.83625v-110.08c0,-5.69164 4.62836,-10.32 10.32,-10.32zM85.72453,41.28672c2.90301,0.00413 5.37031,0.43672 7.05469,1.10188c1.69245,0.66834 2.47817,1.46701 2.77485,2.1164l0.78609,1.73344l1.89469,0.2486c3.94586,0.51527 6.10375,1.99449 7.66609,4.1186c1.56234,2.1241 2.44534,5.12879 2.7211,8.52609c0.55151,6.79462 -1.42422,14.90405 -2.68078,18.51688l-0.87344,2.51953l2.21719,1.47812c-0.24269,-0.16151 0.8429,0.43757 0.645,2.66062v0.00672c-0.54166,5.09431 -2.70875,4.87781 -1.51844,4.87781h-3.11078l-0.31578,3.09063c-0.2537,2.52282 -1.21546,5.46479 -2.33813,7.76687c-1.12266,2.30208 -2.97049,4.05544 -2.43219,3.74906l-1.74015,0.98766v2.00219c0,4.00072 -0.00134,7.50635 0.31578,12.23484l0.04031,0.52406l0.18812,0.49047c1.78614,4.60096 5.78277,7.36943 10.05125,9.4936c4.26848,2.12417 9.08378,3.74369 13.59203,5.69078c4.50825,1.94709 8.65238,4.19677 11.63687,7.22937c2.30424,2.34138 4.00183,5.10894 4.81735,8.90906h-102.22578c0.82112,-3.79232 2.52867,-6.5557 4.85094,-8.90235c3.00928,-3.04087 7.18365,-5.30765 11.7175,-7.2764c4.53385,-1.96876 9.3666,-3.62048 13.63235,-5.79828c4.26575,-2.1778 8.24675,-5.0475 9.9236,-9.74219l0.12094,-0.34265l0.04703,-0.36281c0.66604,-4.96573 0.34265,-8.31097 0.34265,-12.45656v-2.00219l-1.74015,-0.98766c0.29212,0.16598 -0.2902,-0.245 -0.83313,-0.97422c-0.54292,-0.72922 -1.1867,-1.77107 -1.78719,-2.94953c-1.20098,-2.35692 -2.22291,-5.31185 -2.46578,-7.60562l-0.3225,-3.07719h-2.96297c-0.21535,-0.08936 -1.25905,-0.78088 -1.65281,-4.89125l-0.01344,-0.14781l-0.02687,-0.1411c-0.36062,-1.97136 0.63335,-2.33501 0.67859,-2.365l2.04922,-1.35719l-0.62484,-2.38515c-2.68034,-10.22769 -3.05406,-19.54564 -0.29563,-25.77985c2.75429,-6.22482 8.23607,-10.22967 20.19656,-10.52828z"
                              ></path>
                            </g>
                          </g>
                        </svg>
                      </span>
                    </div>
                  </div>
                  <div class="field">
                    <div class="control has-icons-left">
                      <input
                        v-model="mobile"
                        class="input"
                        type="string"
                        placeholder="Mobile"
                      />
                      <span class="icon is-small is-left">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          x="0px"
                          y="0px"
                          width="24"
                          height="24"
                          viewBox="0 0 172 172"
                          style="fill: #000000;"
                        >
                          <g
                            fill="none"
                            fill-rule="nonzero"
                            stroke="none"
                            stroke-width="1"
                            stroke-linecap="butt"
                            stroke-linejoin="miter"
                            stroke-miterlimit="10"
                            stroke-dasharray=""
                            stroke-dashoffset="0"
                            font-family="none"
                            font-weight="none"
                            font-size="none"
                            text-anchor="none"
                            style="mix-blend-mode: normal;"
                          >
                            <path d="M0,172v-172h172v172z" fill="none"></path>
                            <g id="original-icon" fill="#bbbbbb">
                              <path
                                d="M40.72906,10.27969c-2.64719,-0.215 -5.59,0.55094 -8.30438,2.45906c-2.39187,1.66625 -7.55187,5.76469 -12.37594,10.40063c-2.40531,2.31125 -4.70312,4.71656 -6.47687,7.08156c-1.78719,2.365 -3.34594,4.52844 -3.25188,7.67281c0.09406,2.82188 0.37625,11.16656 6.38281,23.95906c6.00656,12.77906 17.65687,30.315 40.37969,53.05125c22.73625,22.73625 40.27219,34.38656 53.05125,40.39312c12.77906,6.00656 21.13719,6.28875 23.95906,6.38281c3.13094,0.09406 5.29437,-1.46469 7.65937,-3.25187c2.365,-1.78719 4.77031,-4.07156 7.08156,-6.47688c4.6225,-4.82406 8.72094,-9.98406 10.38719,-12.37594c3.80281,-5.41531 3.17125,-11.81156 -1.06156,-14.78125c-2.66063,-1.86781 -27.13031,-18.15406 -30.81219,-20.41156c-3.73562,-2.28437 -8.03562,-1.24969 -11.87875,0.77938c-3.02344,1.59906 -11.20687,6.28875 -13.545,7.6325c-1.76031,-1.11531 -8.43875,-5.56313 -22.80344,-19.92781c-14.37812,-14.36469 -18.8125,-21.04313 -19.92781,-22.80344c1.34375,-2.33813 6.02,-10.48125 7.6325,-13.55844c2.01563,-3.82969 3.14438,-8.17 0.73906,-11.9325c-1.00781,-1.59906 -5.59,-8.57312 -10.2125,-15.57406c-4.63594,-7.00094 -9.03,-13.63906 -10.17219,-15.22469v-0.01344c-1.49156,-2.05594 -3.81625,-3.26531 -6.45,-3.48031zM40.0975,17.3075c0.94063,0.12094 1.505,0.49719 1.505,0.49719c0.55094,0.76594 5.375,7.99531 9.9975,14.98281c4.6225,7.00094 9.33906,14.17656 10.15875,15.48c0.13438,0.20156 0.3225,2.48594 -1.02125,5.02563v0.01344c-1.51844,2.88906 -8.6,15.265 -8.6,15.265l-0.98094,1.73344l1.00781,1.72c0,0 5.28094,8.90906 22.07781,25.70594c16.81031,16.79688 25.71938,22.09125 25.71938,22.09125l1.72,1.00781l1.73344,-0.98094c0,0 12.34906,-7.06813 15.265,-8.6c2.53969,-1.33031 4.82406,-1.15563 5.09281,-0.99438c2.37844,1.46469 28.81,19.0275 30.43594,20.16969c0.05375,0.04031 1.49156,2.21719 -0.60469,5.20031h-0.01344c-1.26313,1.81406 -5.40188,7.06813 -9.71531,11.55625c-2.16344,2.24406 -4.38063,4.34031 -6.26188,5.75125c-1.88125,1.41094 -3.56094,1.85438 -3.29219,1.86781c-2.92937,-0.09406 -9.39281,-0.16125 -21.25812,-5.73781c-11.86531,-5.56312 -28.79656,-16.70281 -51.11625,-39.03594c-22.30625,-22.30625 -33.44594,-39.2375 -39.0225,-51.11625c-5.56313,-11.86531 -5.63031,-18.32875 -5.72438,-21.24469c0.01344,0.26875 0.45688,-1.42438 1.86781,-3.30563c1.41094,-1.88125 3.49375,-4.11187 5.73781,-6.27531c4.50156,-4.31344 9.74219,-8.45219 11.55625,-9.71531v0.01344c1.49156,-1.04812 2.795,-1.1825 3.73562,-1.075z"
                              ></path>
                            </g>
                          </g>
                        </svg>
                      </span>
                    </div>
                  </div>
                  <div class="field">
                    <div class="control has-icons-left">
                      <input
                        v-model="email"
                        class="input"
                        type="email"
                        placeholder="Email"
                        @keyup.enter="signUp()"
                      />
                      <span class="icon is-small is-left">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          x="0px"
                          y="0px"
                          width="24"
                          height="24"
                          viewBox="0 0 172 172"
                          style="fill: #000000;"
                        >
                          <g
                            fill="none"
                            fill-rule="nonzero"
                            stroke="none"
                            stroke-width="1"
                            stroke-linecap="butt"
                            stroke-linejoin="miter"
                            stroke-miterlimit="10"
                            stroke-dasharray=""
                            stroke-dashoffset="0"
                            font-family="none"
                            font-weight="none"
                            font-size="none"
                            text-anchor="none"
                            style="mix-blend-mode: normal;"
                          >
                            <path d="M0,172v-172h172v172z" fill="none"></path>
                            <g fill="#bbbbbb">
                              <path
                                d="M18.92,24.08c-8.4925,0 -15.43969,6.93375 -15.48,15.42625c0,0 0,0.01344 0,0.02688c0,0.01344 0,0.01344 0,0.02687v92.88c0,8.50594 6.97406,15.48 15.48,15.48h134.16c8.50594,0 15.48,-6.97406 15.48,-15.48v-92.88c0,-0.01344 0,-0.01344 0,-0.02687c0,-0.01344 0,-0.02688 0,-0.02688c-0.04031,-8.4925 -6.9875,-15.42625 -15.48,-15.42625zM27.86938,30.96h116.27469l-58.14406,40.5275zM16.42063,31.36313l69.57937,48.50937l69.59281,-48.50937c3.52062,1.06156 6.06031,4.25969 6.08719,8.15656c-0.01344,0.72563 -0.7525,2.17688 -1.8275,3.34594c-1.08844,1.1825 -2.15,1.92156 -2.15,1.92156l-0.01344,0.02688l-71.68906,50.74l-71.68906,-50.74l-0.01344,-0.02688c0,0 -1.06156,-0.73906 -2.15,-1.92156c-1.075,-1.16906 -1.81406,-2.62031 -1.8275,-3.34594c0.02688,-3.89687 2.56656,-7.095 6.10063,-8.15656zM10.32,50.40406l0.02688,0.02687l0.02687,0.01344v0.01344l10.26625,7.25625v83.32594h-1.72c-4.78375,0 -8.6,-3.81625 -8.6,-8.6zM161.68,50.40406v82.03594c0,4.78375 -3.81625,8.6 -8.6,8.6h-1.72v-83.32594l10.26625,-7.25625v-0.01344zM27.52,62.57844l58.48,41.3875l58.48,-41.3875v78.46156h-116.96z"
                              ></path>
                            </g>
                          </g>
                        </svg>
                      </span>
                    </div>
                  </div>
                  <div class="field is-grouped" style="margin-top: 30px;">
                    <div class="control is-expanded">
                      <a class="button noobbtn" @click="signUp()">
                        Sign up!
                      </a>
                    </div>
                  </div>
                  <p style="margin-top: 30px;">
                    <nuxt-link to="/account/login">Go to Login</nuxt-link>
                  </p>
                  <p style="margin-top: 20px;">
                    By signing up you agree with the
                    <nuxt-link to="/terms-and-conditions"
                      >Terms and Conditions</nuxt-link
                    >
                    and
                    <nuxt-link to="/privacy-policy">Privacy Policy</nuxt-link>.
                  </p>
                </form>
              </div>
            </div>
          </div>
        </div>
        <div v-else>
          <h1 class="title is-3">Almost there!</h1>
          <p class="content">
            <b>We've sent an email to {{ email }}</b>
          </p>
          <p class="content">
            In the email is a link that will complete your account creation.
            Please check your email and click that link to continue!
          </p>
          <p style="height: 100px;"></p>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  components: {},
  layout: 'nocache-default',
  data: function () {
    return {
      name: '',
      mobile: '',
      email: '',
      state: 0,
    }
  },
  computed: {
    user_loggedin: function () {
      return this.$store.state.user.loggedin
    },
  },
  methods: {
    signUp: function () {
      if (this.$validator.isEmpty(this.name)) {
        this.$notify('failed', 'Please enter name.')
        return
      }
      if (this.$validator.isEmpty(this.mobile)) {
        this.$notify('failed', 'Please enter mobile.')
        return
      }
      if (!this.$validator.isLength(this.mobile, { min: 10, max: 10 })) {
        this.$notify('failed', 'Please enter 10 digit mobile')
        return
      }
      if (!this.$validator.isInt(this.mobile)) {
        this.$notify('failed', 'Please enter 10 digit mobile number')
        return
      }
      if (!this.$validator.isEmail(this.email)) {
        this.$notify('failed', 'Please enter correct email.')
        return
      }
      const self = this
      this.$axios
        .post('/api/user/signup', {
          email: self.email,
          mobile: self.mobile,
          name: self.name,
          trackers: self.$get_trackers(),
        })
        .then(function (response) {
          self.state = 1
        })
        .catch(function (error) {
          if (error.response) {
            if (error.response.data.reason === 'EmailExists') {
              self.$notify(
                'failed',
                'Email already exists. <br>Log In from login page'
              )
              return
            }
          }
          self.$notify('failed', 'Server Error Occured <br>Try Refreshing Page')
        })
        .then(function () {})
    },
  },
}
</script>
